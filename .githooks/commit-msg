#!/bin/bash
# Git commit-msg hook for automatic version bumping
# This hook runs the version bump script before the commit is finalized
#
# To install this hook, run:
#   git config core.hooksPath .githooks
# Or copy it manually:
#   cp .githooks/commit-msg .git/hooks/commit-msg && chmod +x .git/hooks/commit-msg

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Skip if this is a merge commit or amend
if [ -f .git/MERGE_HEAD ] || [ "$GIT_AUTHOR_DATE" != "$GIT_COMMITTER_DATE" ]; then
    exit 0
fi

# Skip if commit message starts with "Merge" or is empty
if [[ "$COMMIT_MSG" =~ ^Merge ]] || [ -z "$COMMIT_MSG" ]; then
    exit 0
fi

# Run version bump script
echo "Running version bump script..."
uv run scripts/generate_agents.py --bump "$COMMIT_MSG"

# Stage any version files that were modified
git add -u .claude-plugin/marketplace.json .claude-plugin/plugin.json 2>/dev/null
git add -u skills/*/reference/scripts/run_actor.py 2>/dev/null

exit 0
